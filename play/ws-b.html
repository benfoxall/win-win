<html>
<head>
	<title>Websockets</title>
	<style type="text/css">
    body{
        margin:0;
    }
	canvas{
		width:100%;height:100%;
		background: #f08
	}
    h1{
        position: fixed;
    }
	</style>
</head>
<body>
	<h1>ws-b</h1>
	<canvas></canvas>
<script type="text/javascript">


	var ws = new WebSocket('ws://'+document.location.host+':8080/','echo-protocol');
	ws.onmessage = function(event){
        // nothing
	};
	ws.onopen = function (event) {
		ws.send("b");
	};

    function send_point(x,y){
        var str = JSON.stringify({x:x,y:y});
        document.getElementsByTagName('h1')[0].innerText = str;
        if (ws && ws.readyState === 1) 
                ws.send(str);
    }


    document.body.addEventListener('touchmove',function(event){
        event.preventDefault();

        var touches=event.touches;
        var str = touches.length + ws.readyState;

        document.getElementsByTagName('h1')[0].innerText = str;

        for (var i=0; i<touches.length; i++) {

            send_point(touches[i].pageX,touches[i].pageY);

        }

    },false);


    document.body.addEventListener('touchstart',function(event){
        event.preventDefault();

        var touches=event.touches;
        var str = touches.length + ws.readyState;

        document.getElementsByTagName('h1')[0].innerText = str;

        for (var i=0; i<touches.length; i++) {

            send_point(touches[i].pageX,touches[i].pageY);

        }

    },false);


    // stop dragging to scroll
	canvas.addEventListener("touchmove", function(event){
		event.preventDefault();
	}, false);


</script>
</body>
</html>