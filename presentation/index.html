<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Win-win messages</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/sky.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>


		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h1>win win</h1>
					<h2>communication</h2>
				</section>

				<section>
					<h1>Ben Foxall</h1>
					<h2>@benjaminbenben</h2>
					<h3>benjaminbenben.com</h3>
					<p><img src="img/white-october.png" style="border:none;box-shadow:none" /></p>
				</section>

				<section class="summary">
					<h2>window</h2>
					<!-- <hr/><h2>.postMessage</h2>
					<hr/><h2>storage events</h2>
					<hr/><h2>websockets (+binary)</h2>
					<hr/><h2>webrtc</h2> -->
				</section>

				<section>
					<section>
						<h2>postMessage</h2>
					</section>

					<section>

<pre><code>
// listener (iframe.html)
$(window).on('message', function(e){
	alert(e.data + "!!1!one!");
})



// parent (main.html)
$('#my-frame').get(0).postMessage('Howdy', '*');


</code></pre>
					</section>
				</section>

				<section class="summary">
					<h2>window</h2>
					<hr/><h2>.postMessage</h2>
					<!-- <hr/><h2>storage events</h2>
					<hr/><h2>websockets (+binary)</h2>
					<hr/><h2>webrtc</h2> -->
				</section>



				<section>
					<section>
						<h2>LocalStorage</h2>
						<h3>+ storage events</h3>
					</section>

					<section>

<pre><code>
localStorage.setItem('my-key','the data');

window.addEventListener("storage", function(e){

 if(e.key == 'my-key')
  console.log(e.newValue); // 'the data'

}, false);

</code></pre>

					</section>

          <section>

<pre><code>if(window.top === window){

// store the new slide index
Reveal.addEventListener('slidechanged', function(e) {
  var send = e.indexh + ',' + e.indexv;
  localStorage.setItem('rslide',send);
});

// restore 
window.addEventListener("storage", function(e){
  if(e.key == 'rslide'){
    var vals = e.newValue.split(',').map(parseFloat);
    Reveal.slide(vals[0],vals[1]);
  }
}, false);

}</code></pre>

          </section>


				</section>

				<section class="summary">
					<h2>window</h2>
					<hr/><h2>.postMessage</h2>
					<hr/><h2>storage events</h2>
					<!-- <hr/><h2>websockets (+binary)</h2>
					<hr/><h2>webrtc</h2> -->
				</section>


        <section>
          <section>
            <h2>WebSockets</h2>
          </section>


          <section>
            <h2>"How the internet works"</h2>
          </section>

          <section>

<pre><code>
var ws = new WebSocket('ws://example.com/');

ws.onmessage = function(event){
  console.log(event.data + '!!')
};

ws.send("Hello")

</code></pre>
          </section>


          <section data-state="demo-1">
            <h2>Demo</h2>
          </section>

        </section>

        <section class="summary">
          <h2>window</h2>
          <hr/><h2>.postMessage</h2>
          <hr/><h2>storage events</h2>
          <hr/><h2>WebSockets</h2>
          <!--hr/><h2>webrtc</h2> -->
        </section>





        <section>
          <section>
            <h2>ws.send(&lt;Blob&gt;)</h2>
          </section>

          <section>

<pre><code>&lt;input id="photo" type="file" accept="image/*" capture="camera" /&gt;</code></pre>

<pre><code>var client = new BinaryClient('ws://localhost:9000');

$('#photo').on('change', function(event){
    var file = event.target.files[0];
    var stream = client.send(file);
});</code></pre>

<p><small>(BinaryClient - <a href="http://binaryjs.com/">binaryjs.com</a>)</small></p>

          </section>

          <section data-state="demo-2">
            <h2>Demo</h2>
          </section>

        </section>


        <section class="summary">
          <h2>window</h2>
          <hr/><h2>.postMessage</h2>
          <hr/><h2>storage events</h2>
          <hr/><h2>WebSockets + binaryjs</h2>
          <!--hr/><h2>webrtc</h2> -->
        </section>







				<section>
					<section>
						<h1>webRTC</h1>

						<p>[image : windows side by side]</p>
					</section>

					<section>
						<h2>LocalStorage</h2>
						<p>storage events</p>
					</section>

				</section>


				<section>
					<section>
						<h1>Remote</h1>
					</section>

					<section>
						<h2>The internets</h2>
						<p>[server, with two clients]</p>
					</section>

					<section>
						<h2>Websockets</h2>
						<p>[code]</p>
					</section>

					<section data-state="demo-1">
						<h2>Demo</h2>
					</section>

					<section data-state="demo-2">
						<h2>Demo #2</h2>
<pre><code contenteditable>&lt;input id="photo" type="file" accept="image/*" capture="camera" /&gt;
</code></pre>

<pre><code contenteditable>var client = BinaryClient('ws://example.com');
$('#photo').on('change', function(event){
    var file = event.target.files[0];
    client.send(file);
});
</code></pre>

<!--hr />

<pre><code contenteditable>binaryclient.on('stream', function(e){
    var parts = [];
    e.on('data', function(d){
        parts.push(d);
    });
    e.on('end', function(d){
        var img = document.createElement("img");
        img.src = window.URL.createObjectURL(new Blob(parts));
        document.body.appendChild(img);
    });
});
</code></pre-->


					</section>

				</section>






				<section>
					<section>
						<h1>Good Stuff</h1>

						<p>[picture of why this is cool from twitter?]</p>
						<p></p>
					</section>

					<section>
						<h1>WebRTC</h1>
						<h2>â€¦Great stuff!</h2>
						<ul>
							<li>MediaStream</li>
							<li>RTCPeerConnection</li>
							<li>RTCDataChannel</li>
						</ul>
					</section>

					<section data-state="demo-1">
						<h2>Demo</h2>
					</section>

					<section data-state="demo-2">
						<h2>Demo2</h2>
					</section>

				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>











		<style type="text/css">
		#connection-status-socketio,
		#connection-status-binary{
			height:2px; width:50%; position: fixed;
			background: #c00; top:0; z-index: 10; }
		#connection-status-binary{right:0;}
		#connection-status-socketio.ok,
		#connection-status-binary.ok{background: #3b759e;}
		</style>
		<div id="connection-status-socketio"></div><div id="connection-status-binary"></div>

	    <script type="text/javascript" src="http://localhost:3000/libs.js"></script>
	    <script type="text/javascript">
	        var shoutHostname = 'localhost';

	        var streams = {
	            socketio:io.connect('http://' + shoutHostname + ':3001'),
	            binary:BinaryClient('ws://'+shoutHostname+':3002')
	        };

			// show status	        
			var statusses = {
	            socketio:document.getElementById('connection-status-socketio'),
	            binary:document.getElementById('connection-status-binary')
	        };

	        streams.binary.on('close', function(){
	        	statusses.binary.className='';
	        });
	        streams.binary.on('open', function(){
	        	statusses.binary.className='ok';
	        });

	        streams.socketio.on('disconnect', function(){
	        	statusses.socketio.className='';
	        });
	        streams.socketio.on('connect', function(){
	        	statusses.socketio.className='ok';
	        });
	    </script>



		<script src="js/jquery.js"></script>


	    <div id="image-show"></div>
		<div id="n4"><canvas width="216" height="362"></canvas></div>

	    <script type="text/javascript">
	    	// display content things

	    	function activeSlide(key){
	    		// .contains, but whatever
	    		return document.getElementsByTagName('html')[0].className.indexOf(key) != -1;
	    	}



	    	var ishow = document.getElementById('image-show');
	    	var n4 = document.getElementById('n4');
			var canvas = n4.childNodes[0];
			var ctx = canvas.getContext('2d');

	    	streams.socketio.on('message', function (message, callback) {

		    	if(activeSlide('demo-1')){



		    		// console.log("OKAYE", message);


					var js = JSON.parse(message);

					if(typeof(js.x) === 'undefined'){

						n4.className = 'active';
						ctx.fillStyle = '#f5f5f5';
						ctx.fillRect(0,0,canvas.width,canvas.height)

					} else {

		    			// console.log("OKAYE", message);

						ctx.fillStyle = '#000000';
						ctx.beginPath();
						ctx.arc(js.x/4.5,js.y/4,10,0,6)
						ctx.fill();

					}


		    	}

	    	});





			streams.binary.on('stream', function(e){


				var parts = [];
				e.on('data', function(d){
						parts.push(d);
				});
				e.on('end', function(d){
					var src = (window.URL || window.webkitURL).createObjectURL(new Blob(parts));
					ishow.style.backgroundImage = 'url(' + src + ')';
					ishow.className = 'active'
				});


				// console.log("STREAM");
	        });


	    	// clean up our stuff
	    	Reveal.addEventListener( 'slidechanged', function() {
	    		// remove the classname
	    		n4.className = '';
	    		ishow.className = ''
	    		ishow.style.backgroundImage = '';
			});


			// only for top level windows
			if(window.top === window){

				// store the new slide index
				Reveal.addEventListener('slidechanged', function(e) {
					var send = e.indexh + ',' + e.indexv;
					localStorage.setItem('rslide',send);
				});

				// restore 
				window.addEventListener("storage", function(e){
					if(e.key == 'rslide'){
						var vals = e.newValue.split(',').map(parseFloat);
						Reveal.slide(vals[0],vals[1]);
					}
				}, false);

			}


	    </script>






	</body>
</html>
